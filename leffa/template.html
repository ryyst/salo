{% extends "base.html" %}
{% from 'macros.html' import card %}

{% block title %}ðŸŽ¬ Bio Salo{% endblock %}

{% block app_title %}ðŸŽ¬ Bio Salo{% endblock %}

{% block header_extra %}
<div class="subtitle">Tulevat elokuvat - seuraavat 2 viikkoa</div>
{% endblock %}

{% block footer_updated %}
PÃ¤ivitetty {{ data.updated_timestamp | default('tuntematon aika') }} - <a href="https://biosalo.fi/" target="_blank">Bio Salo</a>
{% endblock %}

{% block content %}
<div class="container">
  {% if data.movies %}
    {% for movie in data.movies %}
    <div class="movie card" data-genre="{{ movie.genre | lower }}">
      <div class="movie-header">
        {% if movie.poster_url %}
          <img src="https://biosalo.fi/wp-content/plugins/nexxo-scope/banners/{{ movie.poster_url }}" 
               alt="{{ movie.title }}" class="movie-poster" loading="lazy">
        {% else %}
          <div class="movie-poster-placeholder">ðŸŽ¬</div>
        {% endif %}
        
        <div class="movie-info">
          <div class="movie-title">
            <a href="https://biosalo.fi/elokuva/?movie={{ movie.id }}" target="_blank">{{ movie.title }}</a>
          </div>
          
          <div class="movie-meta">
            {% if movie.genre %}<span>{{ movie.genre }}</span>{% endif %}
            {% if movie.duration %}<span>{{ movie.duration }}</span>{% endif %}
            {% if movie.age_limit %}<span>{{ movie.age_limit }}</span>{% endif %}
            {% if movie.release_year %}<span>{{ movie.release_year }}</span>{% endif %}
            {% if movie.director %}<span>Ohj: {{ movie.director }}</span>{% endif %}
          </div>

          {% if movie.intro %}
          <div class="movie-intro">{{ movie.intro }}</div>
          {% endif %}
        </div>
      </div>

      <div class="shows">
        <div class="shows-title">NÃ¤ytÃ¶sajat ({{ movie.shows | length }} nÃ¤ytÃ¶stÃ¤)</div>
        <div class="show-list">
          {% for show in movie.shows %}
          <div class="show">
            <div class="show-time">{{ show.klo }}</div>
            <div class="show-room">{{ show.room_title }}</div>
            <div class="show-price">{{ show.price }}â‚¬</div>
            {% if show.note %}
            <div class="show-note">{{ show.note }}</div>
            {% endif %}
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
    {% endfor %}
  {% else %}
    <div class="no-movies">
      Ei tulevia elokuvia lÃ¶ytynyt.
    </div>
  {% endif %}
</div>
{% endblock %}

{% block styles %}
<style>
  /* Header subtitle styling */
  .subtitle {
    color: var(--color-text-secondary);
    font-size: 0.9rem;
    margin-top: 0.5rem;
  }

  /* Movie styling */
  .movie {
    overflow: hidden;
  }

  .movie-header {
    display: flex;
    align-items: center;
    padding: 0.75rem;
    gap: 0.75rem;
    background: linear-gradient(135deg, var(--color-bg-primary), var(--color-bg-tertiary));
    border-bottom: 1px solid var(--border-color);
    margin: -1rem -1rem 0 -1rem;
  }

  .movie-poster {
    width: 60px;
    height: 80px;
    object-fit: cover;
    border-radius: var(--radius-sm);
    flex-shrink: 0;
    background: var(--color-bg-tertiary);
  }

  .movie-poster-placeholder {
    width: 60px;
    height: 80px;
    background: linear-gradient(135deg, var(--color-bg-tertiary), var(--color-text-muted));
    border-radius: var(--radius-sm);
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: var(--color-text-secondary);
  }

  .movie-info {
    flex: 1;
  }

  .movie-title {
    font-size: 1.1rem;
    font-weight: bold;
    margin-bottom: 0.25rem;
    color: var(--color-text-primary);
  }

  .movie-title a {
    color: var(--color-text-primary);
    text-decoration: none;
  }

  .movie-title a:hover {
    color: var(--color-link);
    text-decoration: underline;
  }

  .movie-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    font-size: 0.8rem;
    color: var(--color-text-secondary);
    margin-bottom: 0.25rem;
  }

  .movie-meta span {
    background: var(--color-bg-tertiary);
    color: var(--color-text-secondary);
    padding: 0.1rem 0.4rem;
    border-radius: 12px;
    font-size: 0.7rem;
  }

  .movie-intro {
    font-size: 0.8rem;
    color: var(--color-text-secondary);
    line-height: 1.3;
    max-height: calc(1.3em * 2);
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
  }

  .shows {
    padding: 0.5rem 0rem 0rem;
  }

  .shows-title {
    font-size: 0.9rem;
    font-weight: bold;
    color: var(--color-text-primary);
    margin-bottom: 0.5rem;
  }

  .show-list {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .show {
    background: var(--color-bg-primary);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-sm);
    padding: 0.4rem 0.6rem;
    font-size: 0.8rem;
    transition: all 0.2s ease;
    cursor: pointer;
  }

  .show:hover {
    background: var(--color-bg-tertiary);
    transform: translateY(-1px);
    box-shadow: var(--shadow-sm);
  }

  .show-time {
    font-weight: bold;
    color: var(--color-accent-primary);
  }

  .show-room {
    color: var(--color-text-secondary);
    font-size: 0.7rem;
  }

  .show-price {
    color: var(--color-accent-success);
    font-weight: 500;
    font-size: 0.7rem;
  }

  .show-note {
    color: var(--color-accent-danger);
    font-size: 0.6rem;
    font-style: italic;
  }

  .no-movies {
    text-align: center;
    color: var(--color-text-secondary);
    padding: 2rem;
    font-style: italic;
  }

  /* Genre color coding - using CSS variables where possible */
  .movie[data-genre*="kauhu"] .movie-header {
    background: linear-gradient(135deg, #f8d7da, #f5c6cb);
  }

  .movie[data-genre*="komedia"] .movie-header {
    background: linear-gradient(135deg, #fff3cd, #ffeaa7);
  }

  .movie[data-genre*="draama"] .movie-header {
    background: linear-gradient(135deg, #d4edda, #c3e6cb);
  }

  .movie[data-genre*="animaatio"] .movie-header,
  .movie[data-genre*="koko perheen"] .movie-header {
    background: linear-gradient(135deg, #cce5ff, #b3d9ff);
  }

  .movie[data-genre*="toiminta"] .movie-header {
    background: linear-gradient(135deg, #ffe0b3, #ffcc80);
  }

  /* Dark mode adjustments for genre colors */
  [data-theme="dark"] .movie[data-genre*="kauhu"] .movie-header {
    background: linear-gradient(135deg, #4a2c2a, #6a2e2a);
  }

  [data-theme="dark"] .movie[data-genre*="komedia"] .movie-header {
    background: linear-gradient(135deg, #4a4a2a, #5a5a2a);
  }

  [data-theme="dark"] .movie[data-genre*="draama"] .movie-header {
    background: linear-gradient(135deg, #2a4a2a, #2a5a2a);
  }

  [data-theme="dark"] .movie[data-genre*="animaatio"] .movie-header,
  [data-theme="dark"] .movie[data-genre*="koko perheen"] .movie-header {
    background: linear-gradient(135deg, #2a2a4a, #2a2a5a);
  }

  [data-theme="dark"] .movie[data-genre*="toiminta"] .movie-header {
    background: linear-gradient(135deg, #4a4a2a, #5a4a2a);
  }

  /* Mobile responsive adjustments */
  @media (max-width: 768px) {
    .movie-header {
      flex-direction: column;
      text-align: center;
      gap: 0.5rem;
    }
    
    .movie-poster,
    .movie-poster-placeholder {
      width: 80px;
      height: 100px;
    }
    
    .show-list {
      justify-content: center;
    }
  }
</style>
{% endblock %}

{% block scripts %}
<script>
  // Add click handler for show times (future enhancement for direct booking)
  document.querySelectorAll('.show').forEach(show => {
    show.addEventListener('click', function() {
      // Could link to booking page in the future
      console.log('Show clicked:', this);
    });
  });
</script>
{% endblock %}