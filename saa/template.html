{% extends "base.html" %}
{% from 'macros.html' import card %}

{% block title %}Säätiedot - {{ data.title }}{% endblock %}

{% block app_title %}Säätiedot{% endblock %}

{% block footer_updated %}
Päivitetty {{ data.updated_timestamp }} - <a href="https://www.ilmatieteenlaitos.fi/" target="_blank">Ilmatieteenlaitos</a>
{% endblock %}

{% block content %}
<div class="container">
  <!-- Daily Forecast Cards -->
  {% for day in data.daily_forecasts %}
  <div class="day-forecast-card" data-day-id="day-{{ loop.index }}">
    <div class="day-header" onclick="toggleDay(event, 'day-{{ loop.index }}')">
      <div class="day-header-content">
        <h3 class="day-title">{{ day.day_name }} {{ day.date_display }}</h3>
        <!-- Day summary with weather warnings and sunrise/sunset -->
        <div class="day-summary">
          {% if day.weather_warnings %}
          <div class="weather-warnings">
            {% for warning in day.weather_warnings %}
            <span class="weather-warning">{{ warning }}</span>
            {% endfor %}
          </div>
          {% endif %}
          {% if day.sunrise and day.sunset %}
          <div class="sun-info">
            Aurinko nousee {{ day.sunrise }}, laskee {{ day.sunset }}.<br/>Päivän pituus {{ day.day_length }}.
          </div>
          {% endif %}
        </div>
      </div>
      <span class="day-arrow{% if loop.index == 1 %} expanded{% endif %}" id="arrow-day-{{ loop.index }}">▼</span>
    </div>

    <!-- Hourly forecast table -->
    <div class="weather-table-container" id="content-day-{{ loop.index }}"  style="display: {% if loop.index > 1 %}none{% else %}block{% endif %};">
      <table class="weather-table">
        <thead>
          <tr>
            <th>Aika</th>
            <th>Sää</th>
            <th>Lämpötila</th>
            <th>Sade</th>
            <th>Kosteus</th>
            <th>Tuuli</th>
          </tr>
        </thead>
        <tbody>
          {% for point in day.points %}
          <tr class="weather-row">
            <td class="time-cell">{{ point.time.split(' - ')[1] if ' - ' in point.time else point.time }}</td>

            <td class="weather-icon-cell">
              <span class="weather-icon">{{ point.weather_icon }}</span>
              {% if point.cloud_cover is not none %}
              <small class="cloud-cover">{{ point.cloud_cover }}%</small>
              {% endif %}
            </td>

            <td class="temperature-cell">
              <span class="temp-value" style="color: {{ point.temperature_color }};">
                {% if point.temperature is not none %}{{ "%.1f"|format(point.temperature) }}°C{% else %}N/A{% endif %}
              </span>
            </td>

            <td class="precipitation-cell">
              <div class="rain-info">
                <span class="rain-amount {% if point.precipitation is none %}rain-none
                          {% elif point.precipitation == 0 %}rain-none
                          {% elif point.precipitation <= 0.5 %}rain-light
                          {% elif point.precipitation <= 2.0 %}rain-moderate
                          {% else %}rain-heavy{% endif %}">
                  {% if point.precipitation is not none %}{{ "%.1f"|format(point.precipitation) }}mm{% else %}-{% endif %}
                </span>
                {% if point.precipitation_probability is not none %}
                <small class="rain-probability">({{ "%.0f"|format(point.precipitation_probability) }}%)</small>
                {% endif %}
              </div>
            </td>

            <td class="humidity-cell">
              {% if point.humidity is not none %}
              <span class="humidity-value">{{ "%.0f"|format(point.humidity) }}%</span>
              {% else %}
              <span class="humidity-value text-muted">N/A</span>
              {% endif %}
            </td>

            <td class="wind-cell">
              <div class="wind-info">
                {% if point.wind_speed is not none %}
                <span class="wind-speed">{{ "%.1f"|format(point.wind_speed) }}m/s</span>
                {% endif %}
                {% if point.wind_direction is not none %}
                <span class="wind-arrow" style="transform: rotate({{ point.wind_direction }}deg);">↑</span>
                {% endif %}
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  {% endfor %}
</div>
{% endblock %}

{% block styles %}
<style>
  /* Temperature color theme variables */
  :root,
  :root[data-theme="light"] {
    --temp-lightness: 45%; /* Darker for light theme - better contrast */
  }

  :root[data-theme="dark"] {
    --temp-lightness: 55%; /* Lighter for dark theme - better visibility */
  }


  /* Weather-specific styling using the design system */

  /* Overview styling */
  .weather-overview {
    text-align: center;
    margin: 0;
  }

  .location-info {
    font-size: var(--font-size-lg);
    font-weight: 600;
    color: var(--color-text-primary);
    margin: 0 0 0.5rem 0;
  }

  .forecast-summary {
    color: var(--color-text-secondary);
    margin: 0;
  }

  /* Daily forecast cards */
  .day-forecast-card {
    background: var(--color-bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    margin-bottom: 1.5rem;
    box-shadow: var(--shadow-sm);
    transition: all 0.3s ease;
  }

  .day-forecast-card:hover {
    box-shadow: var(--shadow-md);
  }

  .day-header {
    padding: 1rem;
    cursor: pointer;
    user-select: none;
    display: flex;
    align-items: flex-start;
    width: 100%;
  }

  .day-header-content {
    flex: 1;
    min-width: 0;
  }

  .day-title {
    margin: 0 0 0.5rem 0;
    font-size: var(--font-size-lg);
    font-weight: 600;
    color: var(--color-text-primary);
  }

  .day-arrow {
    font-size: 18px;
    transition: transform 0.3s ease;
    cursor: pointer;
    padding: 0.5rem;
    margin-left: auto;
    flex-shrink: 0;
    color: var(--color-text-secondary);
  }

  .day-arrow.expanded {
    transform: rotate(180deg);
  }

  .day-summary {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    margin-bottom: 0;
    align-items: flex-start;
  }

  .weather-warnings {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .weather-warning {
    background: var(--color-bg-tertiary);
    color: var(--color-text-primary);
    padding: 0.375rem 0.75rem;
    border-radius: var(--radius-md);
    font-size: 0.75rem;
    font-weight: 500;
    border: 1px solid var(--border-color);
    white-space: nowrap;
  }

  .sun-info {
    font-size: var(--font-size-xs);
    font-weight: 500;
    color: var(--color-text-secondary);
    text-align: left;
    flex: 1;
    min-width: 200px;
  }

  /* Weather table improvements */
  .weather-table-container {
    overflow-x: auto;
  }

  .weather-table {
    width: 100%;
    border-collapse: collapse;
    font-size: var(--font-size-sm);
    margin: 0;
  }

  .weather-table th {
    background: var(--color-bg-tertiary);
    color: var(--color-text-secondary);
    font-weight: 600;
    padding: 0.75rem 0.5rem;
    text-align: center;
    border-bottom: 2px solid var(--border-color);
    font-size: 0.875rem;
    letter-spacing: 0.025em;
    position: sticky;
    top: 0;
  }

  .weather-table td {
    padding: 0.75rem 0.5rem;
    border-bottom: 1px solid var(--border-color);
    color: var(--color-text-secondary);
    text-align: center;
    vertical-align: middle;
  }

  .weather-row:hover td {
    background: var(--color-bg-tertiary);
  }

  /* Weather icon styling */
  .weather-icon-cell {
    text-align: center;
  }

  .weather-icon {
    font-size: 1.5rem;
    display: block;
    margin-bottom: 0.25rem;
  }

  .cloud-cover {
    color: var(--color-text-muted);
    font-size: 0.625rem;
    display: block;
  }

  /* Temperature styling with dynamic colors */
  .temp-value {
    font-weight: 500;
    font-size: 1rem;
  }

  /* Precipitation styling */
  .rain-info {
    display: flex;
    flex-direction: column;
    gap: 0.125rem;
    align-items: center;
  }

  .rain-amount {
    font-weight: 500;
  }

  .rain-none {
    color: var(--color-text-muted);
  }

  .rain-light {
    color: var(--color-accent-primary);
  }

  .rain-moderate {
    color: var(--color-accent-primary);
    font-weight: 600;
  }

  .rain-heavy {
    color: var(--color-accent-danger);
    font-weight: 600;
  }

  .rain-probability {
    font-size: 0.75rem;
    color: var(--color-text-muted);
  }

  /* Humidity styling */
  .humidity-cell {
    text-align: center;
  }

  .humidity-value {
    font-weight: 500;
    color: var(--color-accent-primary);
  }

  /* Wind styling */
  .wind-info {
    display: flex;
    flex-direction: row;
    gap: 0.25rem;
    align-items: center;
    justify-content: center;
  }

  .wind-speed {
    font-weight: 500;
  }

  .wind-arrow {
    font-size: 1.25rem;
    color: var(--color-text-secondary);
    transition: transform 0.2s ease;
  }

  /* Time cell styling */
  .time-cell {
    font-weight: 500;
    color: var(--color-text-primary);
    white-space: nowrap;
    font-size: 0.875rem;
  }

  /* Mobile responsive adjustments */
  @media (max-width: 768px) {
    .day-forecast-card {
      margin-bottom: 1rem;
    }

    .day-summary {
      flex-direction: column;
      gap: 0.75rem;
    }

    .weather-warning {
      font-size: 0.75rem;
      padding: 0.25rem 0.5rem;
    }

    .sun-info {
      min-width: unset;
    }

    .sun-times {
      gap: 1rem;
      font-size: 0.8rem;
    }

    .weather-table {
      font-size: 0.7rem;
    }

    .weather-table th,
    .weather-table td {
      padding: 0.5rem 0.25rem;
    }

    .weather-icon {
      font-size: 1.25rem;
    }

    .temp-value {
      font-size: 0.875rem;
    }

    .wind-info,
    .rain-info {
      gap: 0.25rem;
    }

    .rain-probability,
    .cloud-cover {
      font-size: 0.5rem;
    }

    .time-cell {
      font-size: 0.65rem;
    }
  }
</style>
{% endblock %}

{% block extra_head %}
<script>
function toggleDay(event, dayId) {
  const content = document.getElementById('content-' + dayId);
  const arrow = document.getElementById('arrow-' + dayId);

  if (content.style.display === 'none' || content.style.display === '') {
    content.style.display = 'block';
    arrow.classList.add('expanded');
  } else {
    content.style.display = 'none';
    arrow.classList.remove('expanded');
  }
}
</script>
{% endblock %}
