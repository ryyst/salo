{% extends "base.html" %}
{% from 'macros.html' import card %}

{% block title %}Säätiedot - {{ data.title }}{% endblock %}

{% block app_title %}Säätiedot{% endblock %}

{% block footer_updated %}
Päivitetty {{ data.updated_timestamp }} - <a href="https://www.ilmatieteenlaitos.fi/" target="_blank">Ilmatieteenlaitos</a>
{% endblock %}

{% block content %}
<div class="container">
  <!-- Daily Forecast Cards -->
  {% for day in data.daily_forecasts %}
  {% call card(title="" + day.day_name + " " + day.date_display, class="day-forecast-card") %}
    <!-- Day summary with sunrise/sunset -->
    <div class="day-summary">
      {% if day.sunrise and day.sunset %}
      <div class="sun-info">
        Aurinko nousee {{ day.sunrise }}, laskee {{ day.sunset }}. Päivän pituus {{ day.day_length }}.
      </div>
      {% endif %}
    </div>

    <!-- Hourly forecast table -->
    <div class="weather-table-container">
      <table class="weather-table">
        <thead>
          <tr>
            <th>Aika</th>
            <th>Sää</th>
            <th>Lämpötila</th>
            <th>Sade</th>
            <th>Kosteus</th>
            <th>Tuuli</th>
          </tr>
        </thead>
        <tbody>
          {% for point in day.points %}
          <tr class="weather-row">
            <td class="time-cell">{{ point.time.split(' - ')[1] if ' - ' in point.time else point.time }}</td>

            <td class="weather-icon-cell">
              <span class="weather-icon">{{ point.weather_icon }}</span>
              {% if point.cloud_cover is not none %}
              <small class="cloud-cover">{{ point.cloud_cover }}%</small>
              {% endif %}
            </td>

            <td class="temperature-cell">
              <span class="temp-value" style="color: {{ point.temperature_color }}; font-weight: 600;">
                {% if point.temperature is not none %}{{ "%.1f"|format(point.temperature) }}°C{% else %}N/A{% endif %}
              </span>
            </td>

            <td class="precipitation-cell">
              <div class="rain-info">
                <span class="rain-amount {% if point.precipitation == 0 %}rain-none
                          {% elif point.precipitation <= 0.5 %}rain-light
                          {% elif point.precipitation <= 2.0 %}rain-moderate
                          {% else %}rain-heavy{% endif %}">
                  {% if point.precipitation is not none %}{{ "%.1f"|format(point.precipitation) }}mm{% else %}0mm{% endif %}
                </span>
                {% if point.precipitation_probability is not none %}
                <small class="rain-probability">({{ "%.0f"|format(point.precipitation_probability) }}%)</small>
                {% endif %}
              </div>
            </td>

            <td class="humidity-cell">
              {% if point.humidity is not none %}
              <span class="humidity-value">{{ "%.0f"|format(point.humidity) }}%</span>
              {% else %}
              <span class="humidity-value text-muted">N/A</span>
              {% endif %}
            </td>

            <td class="wind-cell">
              <div class="wind-info">
                {% if point.wind_speed is not none %}
                <span class="wind-speed">{{ "%.1f"|format(point.wind_speed) }}m/s</span>
                {% endif %}
                {% if point.wind_direction is not none %}
                <span class="wind-arrow" style="transform: rotate({{ point.wind_direction }}deg);">↑</span>
                {% endif %}
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% endcall %}
  {% endfor %}
</div>
{% endblock %}

{% block styles %}
<style>
  /* Weather-specific styling using the design system */

  /* Overview styling */
  .weather-overview {
    text-align: center;
    margin: 0;
  }

  .location-info {
    font-size: var(--font-size-lg);
    font-weight: 600;
    color: var(--color-text-primary);
    margin: 0 0 0.5rem 0;
  }

  .forecast-summary {
    color: var(--color-text-secondary);
    margin: 0;
  }

  /* Daily forecast cards */
  .day-forecast-card {
    margin-bottom: 1.5rem;
  }

  .day-summary {
    display: flex;
    margin-bottom: 1rem;
  }

  .sun-info {
    font-size: var(--font-size-xs);
    font-weight: 500;
    color: var(--color-text-secondary);
    text-align: left;
  }

  /* Weather table improvements */
  .weather-table-container {
    overflow-x: auto;
    margin: 0 -1rem;
  }

  .weather-table {
    width: 100%;
    border-collapse: collapse;
    font-size: var(--font-size-sm);
    margin: 0;
  }

  .weather-table th {
    background: var(--color-bg-tertiary);
    color: var(--color-text-secondary);
    font-weight: 600;
    padding: 0.75rem 0.5rem;
    text-align: center;
    border-bottom: 2px solid var(--border-color);
    font-size: 0.875rem;
    letter-spacing: 0.025em;
    position: sticky;
    top: 0;
  }

  .weather-table td {
    padding: 0.75rem 0.5rem;
    border-bottom: 1px solid var(--border-color);
    color: var(--color-text-secondary);
    text-align: center;
    vertical-align: middle;
  }

  .weather-row:hover td {
    background: var(--color-bg-tertiary);
  }

  /* Weather icon styling */
  .weather-icon-cell {
    text-align: center;
  }

  .weather-icon {
    font-size: 1.5rem;
    display: block;
    margin-bottom: 0.25rem;
  }

  .cloud-cover {
    color: var(--color-text-muted);
    font-size: 0.625rem;
    display: block;
  }

  /* Temperature styling with dynamic colors */
  .temp-value {
    font-weight: 600;
    font-size: 1rem;
  }

  /* Precipitation styling */
  .rain-info {
    display: flex;
    flex-direction: column;
    gap: 0.125rem;
    align-items: center;
  }

  .rain-amount {
    font-weight: 500;
  }

  .rain-none {
    color: var(--color-text-muted);
  }

  .rain-light {
    color: var(--color-accent-primary);
  }

  .rain-moderate {
    color: var(--color-accent-primary);
    font-weight: 600;
  }

  .rain-heavy {
    color: var(--color-accent-danger);
    font-weight: 600;
  }

  .rain-probability {
    font-size: 0.75rem;
    color: var(--color-text-muted);
  }

  /* Humidity styling */
  .humidity-cell {
    text-align: center;
  }

  .humidity-value {
    font-weight: 500;
    color: var(--color-accent-primary);
  }

  /* Wind styling */
  .wind-info {
    display: flex;
    flex-direction: row;
    gap: 0.25rem;
    align-items: center;
    justify-content: center;
  }

  .wind-speed {
    font-weight: 500;
  }

  .wind-arrow {
    font-size: 1.25rem;
    color: var(--color-text-secondary);
    transition: transform 0.2s ease;
  }

  /* Time cell styling */
  .time-cell {
    font-weight: 500;
    color: var(--color-text-primary);
    white-space: nowrap;
    font-size: 0.875rem;
  }

  /* Mobile responsive adjustments */
  @media (max-width: 768px) {
    .day-forecast-card {
      margin-bottom: 1rem;
    }

    .sun-times {
      gap: 1rem;
      font-size: 0.8rem;
    }

    .weather-table {
      font-size: 0.7rem;
    }

    .weather-table th,
    .weather-table td {
      padding: 0.5rem 0.25rem;
    }

    .weather-icon {
      font-size: 1.25rem;
    }

    .temp-value {
      font-size: 0.875rem;
    }

    .wind-info,
    .rain-info {
      gap: 0.25rem;
    }

    .rain-probability,
    .cloud-cover {
      font-size: 0.5rem;
    }

    .time-cell {
      font-size: 0.65rem;
    }

    /* Hide less important columns on very small screens */
    @media (max-width: 480px) {
      .humidity-cell,
      .weather-table th:nth-child(5) {
        display: none;
      }
    }
  }

  /* Print styling */
  @media print {
    .day-forecast-card {
      break-inside: avoid;
      margin-bottom: 1rem;
    }

    .weather-icon {
      font-size: 1rem;
    }
  }
</style>
{% endblock %}
